<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded',() => {
            // Connect to websocket
            var socket = io();

            socket.on('connect',room_name => {
                socket.emit('submit',{'guess':'Connected'},room=room_name);
                document.querySelector("#guess").onclick = () => {
                    val = document.querySelector("#msg").value;
                    socket.emit('submit',{'guess':val},room=room_name);
                };
            });
            socket.on('announce',guess => {
                const li = document.createElement('li');
                li.innerHTML=`${guess.guess}`;
                document.querySelector('#guesses').append(li);
                document.querySelector('#msg').value = '';
            });

        });
    </script>
    <title>Title</title>
</head>
<body style="background-color:#05E5F9 ;">
      <div style="margin-right=0; width=20%">
		<ul id="guesses"></ul>
		<input type="text" id="msg">
		<button id="guess">Guess</button>
		</div>
      <svg id="draw" style="width:50%; height:500px; margin-left:25%; background-color:white;">
      </svg>
	  <div class="container" style="margin-left:25%;">
          <div id="options" class="row">
              <select id="color-picker">
                  <option value="black">Black</option>
                  <option value="red">Red</option>
                  <option value="blue">Blue</option>
                  <option value="green">Green</option>
				  <option value="yellow">Yellow</option>
				  <option value="pink">Pink</option>
				  <option value="brown">Brown</option>
				  <option value="gray">Gray</option>
				  <option value="white">White</option>
				  <option value="orange">Orange</option>
                  <option value="#05E5F9 ">Sky Blue</option>
              </select>
              <select id="thickness-picker">
                  <option value=1>1</option>
                  <option value=2>2</option>
                  <option value=3 selected>3</option>
                  <option value=4>4</option>
                  <option value=5>5</option>
                  <option value=6>6</option>
                  <option value=7>7</option>
                  <option value=8>8</option>
                  <option value=9>9</option>
                  <option value=10>10</option>
              </select>
              <button id="erase">Erase</button>
          </div>
      </div>
  </body>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script>
  document.addEventListener('DOMContentLoaded', () => {

      // state
      let draw = false;

      // elements
      let points = [];
      let lines = [];
      let svg = null;

      function render() {

          // create the selection area
          svg = d3.select('#draw')
                  .attr('height', window.innerHeight)
                  .attr('width', window.innerWidth);

          svg.on('mousedown', function() {
              draw = true;
              const coords = d3.mouse(this);
              draw_point(coords[0], coords[1], false);
          });

          svg.on('mouseup', () =>{
              draw = false;
          });

          svg.on('mousemove', function() {
              if (!draw)
                  return;
              const coords = d3.mouse(this);
              draw_point(coords[0], coords[1], true);
          });

		  svg.on('touchstart', function() {
              draw = true;
              const coords = d3.mouse(this);
              draw_point(coords[0], coords[1], false);
          });

          svg.on('touchend', () =>{
              draw = false;
          });

          svg.on('touchmove', function() {
              if (!draw)
                  return;
              const coords = d3.mouse(this);
              draw_point(coords[0], coords[1], true);
          });

          document.querySelector('#erase').onclick = () => {
              for (let i = 0; i < points.length; i++)
                  points[i].remove();
              for (let i = 0; i < lines.length; i++)
                  lines[i].remove();
              points = [];
              lines = [];
          };

      };

      function draw_point(x, y, connect) {

		const color = document.querySelector('#color-picker').value;
          const thickness = document.querySelector('#thickness-picker').value;

          if (connect) {
              const last_point = points[points.length - 1];
              const line = svg.append('line')
                              .attr('x1', last_point.attr('cx'))
                              .attr('y1', last_point.attr('cy'))
                              .attr('x2', x)
                              .attr('y2', y)
                              .attr('stroke-width', thickness * 2)
                              .style('stroke', color);
              lines.push(line);
          }

          const point = svg.append('circle')
                           .attr('cx', x)
                           .attr('cy', y)
                           .attr('r', thickness)
                           .style('fill', color);
          points.push(point);
      };

      render();
  });
  </script>
</html>